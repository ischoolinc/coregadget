<div class="tab-content">
  <app-permission-denied *ngIf="!roleService.isLoading && !roleService.enableComprehensive">
  </app-permission-denied>
  <div *ngIf="!roleService.isLoading && roleService.enableComprehensive"
       class="tab-pane fade-in show active">
    <ng-container *ngIf="!isLoading;else tmpLoading">
      <!-- <div class="float-right d-flex mb-3 mb-md-0 sticky-top">
        <ng-container *ngTemplateOutlet="plugin"></ng-container>
      </div> -->
      <ng-container *ngIf="sectionList.length>0;else noData">
        <div class="d-flex align-items-stretch">
          <div>
            <div class="dropdown h-100">
              <button class="btn btn-light dropdown-toggle h-100"
                      type="button"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false">
                <span>{{ currentSemester.SchoolYear }}學年度 第{{currentSemester.Semester}}學期 {{currentSection.Name}}</span>
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"
                   *ngFor="let sectionRec of sectionList"
                   [ngClass]="{ active: sectionRec === currentSection }"
                   [routerLink]="[ sectionRec.FillInSectionID, 'section']">
                  <span>{{ sectionRec.Name }}</span>
                </a>
              </div>
            </div>
          </div>
          <div *ngIf="currentSection"
               class="ml-2">
            <div class="dropdown h-100">
              <button class="btn btn-light dropdown-toggle h-100"
                      type="button"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false">
                <span *ngIf="currentClass">{{ currentClass.ClassName}}</span>
                <span *ngIf="!currentClass">總攬</span>
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item"
                   [ngClass]="{ active: !currentClass }"
                   [routerLink]="['/comprehensive', currentSection.FillInSectionID, 'section']">
                  <span>總攬</span>
                </a>
                <a class="dropdown-item"
                   *ngFor="let classRec of currentSection.Class"
                   [ngClass]="{ active: classRec === currentClass }"
                   [routerLink]="['/comprehensive', currentSection.FillInSectionID, 'class',  classRec.ClassID]">
                  <span>{{ classRec.ClassName }}</span>
                </a>
              </div>
            </div>
          </div>
          <button class="btn btn-light ml-2"
                  type="button"
                  (click)="genSSNKey(currentSection.FillInSectionID)">
            <span>產生填寫代碼(身分證號)</span>
          </button>
          <a class="text-info ml-2 ml-auto my-auto"
             target="_blank"
             [attr.href]="'content.htm#/(simple-page:simple-page/'+dsns+'/comprehensive_fill)'">填寫頁面</a>
          <button class="btn btn-info ml-2"
                  (click)="shoModal()">
            <i class="material-icons">add</i> 產生綜合紀錄表
          </button>
        </div>
        <router-outlet></router-outlet>
      </ng-container>
      <ng-template #noData>
        <div *ngIf="currentSemester"
             class="d-flex">
          <div>
            <span>目前學年度：{{ currentSemester.SchoolYear }}學年度 第{{currentSemester.Semester}}學期</span>
          </div>
          <button class="btn btn-info ml-auto"
                  (click)="shoModal()">
            <i class="material-icons">add</i> 產生綜合紀錄表
          </button>
        </div>
        <div class="row justify-content-center"
             style="margin-top:250px;margin-bottom:200px;">
          沒有資料
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>

<ng-template #tmpLoading
             class="container">
  <div class="row justify-content-center"
       style="margin-top:250px;margin-bottom:200px;">
    Loading...
  </div>
</ng-template>


<!-- 建立新個案 Modal -->
<div class="modal fade"
     id="GenerateFillInData"
     tabindex="-1"
     role="dialog"
     aria-labelledby="newCaseLabel"
     aria-hidden="true">
  <div class="modal-dialog"
       role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"
            id="newCaseLabel">
          產生綜合紀錄表
        </h5>
        <button *ngIf="!generater.isSaving"
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body pb-0">
        <ng-container *ngIf="generater.isLoading">
          資料讀取中...
        </ng-container>
        <ng-container *ngIf="!generater.isLoading">
          <p>產生{{generater.schoolYear}}學年度 第{{generater.semester}}學期 在校學生的綜合紀錄表資料，將花費較多時間，請耐心等候。</p>
        </ng-container>
        <ng-container *ngIf="generater.isSaving">
          <div class="progress">
            <div class="progress-bar"
                 role="progressbar"
                 [ngStyle]="{'width': generater.progress + '%'}"
                 [attr.aria-valuenow]="generater.progress"
                 aria-valuemin="0"
                 aria-valuemax="100">{{generater.progress}}%</div>
          </div>
        </ng-container>
      </div>
      <div class="modal-footer">
        <h6 *ngIf="generater.isSaving"
            class="text-muted ml-4 mr-auto">{{generater.currentClass}}</h6>
        <button type="button"
                class="btn btn-info"
                (click)="generater.gen()"
                [disabled]="generater.isLoading || generater.isSaving">
          產生
        </button>
      </div>
    </div>
  </div>
</div>