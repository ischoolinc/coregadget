<div id="gadget" class="my-page">
  <div #mainMsg [class]="mainMsgClass">{{mainMsgText}}</div>

  <div class="row-fluid">
    <div class="span12">
      <h1 *ngIf="loadState !== 'finish'">選課</h1>
      <h1 *ngIf="loadState === 'finish'">
        <span>{{currSchoolYear}} 學年度 {{currSemester | semesterFormat}}</span>
        <ul class="nav nav-tabs my-navtabs">
          <li [ngClass]="{'active': currTab === 'sa01'}" *ngIf="['s5', 'choose', 'beforeChoose'].indexOf(currLevel) !== -1"><a
              href="javascript:;" (click)="toggleTab('sa01')">可選課程</a></li>
          <li [ngClass]="{'active': currTab === 'sa06'}" *ngIf="['afterChoose', 'announcement', 'afterAnnouncement', 'increment'].indexOf(currLevel) !== -1"><a
            href="javascript:;" (click)="toggleTab('sa06')">選課結果</a></li>
          <li [ngClass]="{'active': currTab === 'sa07'}" *ngIf="['afterIncrement'].indexOf(currLevel) !== -1"><a
            href="javascript:;" (click)="toggleTab('sa07')">選課結果</a></li>
          <li [ngClass]="{'active': currTab === 'sa02'}"><a href="javascript:;" (click)="toggleTab('sa02')">課程總表</a></li>
          <li [ngClass]="{'active': currTab === 'sa03'}"><a href="javascript:;" (click)="toggleTab('sa03')">衝堂與限制複選課程</a></li>
          <li [ngClass]="{'active': currTab === 'sa04'}"><a href="javascript:;" (click)="toggleTab('sa04')">選課注意事項</a></li>
          <li [ngClass]="{'active': currTab === 'sa05'}"><a href="javascript:;" (click)="toggleTab('sa05')">選課問答集</a></li>
          <li [ngClass]="{'active': currTab === 'sa08'}"><a href="javascript:;" (click)="toggleTab('sa08')">保證金</a></li>
        </ul>
      </h1>
      <div class="tab-content">
        <div>
          {{['載入中...', '載入失敗', '非畢業校友請至一般學生選課功能。', '目前尚未開放選課', '您目前沒有校友選課權限，請聯繫EMBA辦公室。'][['loading', 'error', 'limited',
          'closed', 'black'].indexOf(loadState)]}}
        </div>
        <ng-container *ngIf="loadState === 'finish'">
          <div [ngClass]="{'active': currTab === 'sa01', 'fade': currTab !== 'sa01'}" class="tab-pane sa01">
            <div>
              {{['目前尚未開放選課', '目前尚未開放選課'][['beforeChoose', 's5'].indexOf(currLevel)]}}
            </div>
            <div *ngIf="['beforeChoose', 's5'].indexOf(currLevel) === -1">
              <div class="alert alert-info2">
                <ng-container *ngIf="openingDate?.StartDate || openingDate?.EndDate">
                  選課時間：{{openingDate.StartDate || '未設定'}}
                  至 {{openingDate.EndDate || '未設定' }} 止。
                </ng-container>
              </div>

              <!--選課說明文字-->
              <div class="alert alert-info">
                <div style="color:black; background-color:white;"
                  [innerHTML]="configuration.emba_alumnicoursemodule_course_description_temp | safeHtml"></div>
              </div>

              <div *ngIf="currLevel == 'choose'" class='memb-list'>
                <app-add-quit-buttons
                  [conflicted]="conflicted"
                  (onConfirmSave)="confirmQuitAddCourse()"
                  (onResetAddQuit)="resetAddQuit()"
                ></app-add-quit-buttons>
              </div>

              <!-- 已選清單 -->
              <table class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th colspan="9" class="my-table-head1"><span style="color: blue">已選課程</span></th>
                  </tr>
                  <tr>
                    <th style="font-size: 3">退選</th>
                    <th>課程編號</th>
                    <th>班次</th>
                    <th>課程名稱</th>
                    <th>授課教師</th>
                    <th>學分</th>
                    <th>人數上限</th>
                    <th>教室</th>
                    <th>上課時間</th>
                  </tr>
                </thead>
                <tbody *ngFor="let item of currAttends" data-type="quit">
                  <tr [ngClass]="{'my-error': item.HaveConflict.length > 0}">
                    <td rowspan="2" class="my-cbx-style">
                      <input type="checkbox"
                        [tooltip]="conflictCourseNames(item.HaveConflict)" placement="right"
                        [(ngModel)]="item.WillQuit" [value]="item.AlumniID"
                        (click)="clickCourseCheckbox(item, 'WillQuit')"
                        style="width: 20px; height: 20px;">
                    </td>
                    <td>{{item.NewSubjectCode}}</td>
                    <td>{{item.ClassName}}</td>
                    <td>
                      <a *ngIf="item.Syllabus" [href]="item.Syllabus" target="_blank">{{item.CourseName}}</a>
                      <span *ngIf="!item.Syllabus">{{item.CourseName}}</span>
                    </td>
                    <td [innerHTML]="item.TeacherURLName | safeHtml"></td>
                    <td>{{item.Credit}}</td>
                    <td>{{item.MumberOfElectives}}</td>
                    <td>{{item.Classroom}}</td>
                    <td>{{item.CourseTimeInfo}}</td>
                  </tr>
                  <tr [ngClass]="{'my-error': item.HaveConflict.length > 0}">
                    <td colspan="8">{{item.Memo}}</td>
                  </tr>
                </tbody>
                <tbody *ngIf="getLevelItems() === 0">
                  <tr>
                    <td colspan="9">目前無資料</td>
                </tbody>
              </table>
              <!-- 可選課清單 -->
              <table class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th colspan="9" class="my-table-head2"><span style="color: red">可選課程</span>清單</th>
                  </tr>
                  <tr>
                    <th style="font-size: 3">加選</th>
                    <th>課程編號</th>
                    <th>班次</th>
                    <th>課程名稱</th>
                    <th>授課教師</th>
                    <th>學分</th>
                    <th>人數上限</th>
                    <th>教室</th>
                    <th>上課時間</th>
                  </tr>
                </thead>
                <tbody *ngFor="let item of canChooseCourses" data-type="add">
                  <tr [ngClass]="{'my-error': item.HaveConflict.length > 0}">
                    <td rowspan="2" class="my-cbx-style">
                      <input type="checkbox"
                        [tooltip]="conflictCourseNames(item.HaveConflict)" placement="right"
                        [(ngModel)]="item.WillAdd" [value]="item.AlumniID"
                        (click)="clickCourseCheckbox(item, 'WillAdd')"
                        style="width: 20px; height: 20px;">
                    </td>
                    <td>{{item.NewSubjectCode}}</td>
                    <td>{{item.ClassName}}</td>
                    <td>
                      <a *ngIf="item.Syllabus" [href]="item.Syllabus" target="_blank">{{item.CourseName}}</a>
                      <span *ngIf="!item.Syllabus">{{item.CourseName}}</span>
                    </td>
                    <td [innerHTML]="item.TeacherURLName | safeHtml"></td>
                    <td>{{item.Credit}}</td>
                    <td>{{item.MumberOfElectives}}</td>
                    <td>{{item.Classroom}}</td>
                    <td>{{item.CourseTimeInfo}}</td>
                  </tr>
                  <tr [ngClass]="{'my-error': item.HaveConflict.length > 0}">
                    <td colspan="8">{{item.Memo}}</td>
                  </tr>
                </tbody>
                <tbody *ngIf="canChooseCourses.length === 0">
                  <tr>
                    <td colspan="9">目前無資料</td>
                </tbody>
              </table>

              <div *ngIf="currLevel == 'choose'" class='memb-list'>
                <app-add-quit-buttons
                  [conflicted]="conflicted"
                  (onConfirmSave)="confirmQuitAddCourse()"
                  (onResetAddQuit)="resetAddQuit()"
                ></app-add-quit-buttons>
              </div>
            </div>
          </div>
          <div [ngClass]="{'active': currTab === 'sa02', 'fade': currTab !== 'sa02'}" class="tab-pane sa02">
            <div>
              {{['目前無資料'][['beforeChoose'].indexOf(currLevel)]}}
            </div>
            <div *ngIf="['beforeChoose'].indexOf(currLevel) === -1">
              <table class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th>課程編號</th>
                    <th>課程名稱</th>
                    <th>授課教師</th>
                    <th>人數上限</th>
                    <th>教室</th>
                    <th>上課時間</th>
                  </tr>
                </thead>
                <tbody *ngFor="let item of allCourse | mapsToArray">
                  <tr>
                    <td>{{item.NewSubjectCode}}</td>
                    <td>
                      <a *ngIf="item.Syllabus" [href]="item.Syllabus" target="_blank">{{item.CourseName}}</a>
                      <span *ngIf="!item.Syllabus">{{item.CourseName}}</span>
                    </td>
                    <td [innerHTML]="item.TeacherURLName | safeHtml"></td>
                    <td>{{item.MumberOfElectives}}</td>
                    <td>{{item.Classroom}}</td>
                    <td>{{item.CourseTimeInfo}}</td>
                  </tr>
                  <tr>
                    <td colspan="6">{{item.Memo}}</td>
                  </tr>
                </tbody>
                <tbody *ngIf="allCourse.size === 0">
                  <tr>
                    <td colspan="6">目前無資料</td>
                </tbody>
              </table>
            </div>
          </div>
          <div [ngClass]="{'active': currTab === 'sa03', 'fade': currTab !== 'sa03'}" class="tab-pane sa03">
            <div>
              {{['目前無資料'][['beforeChoose'].indexOf(currLevel)]}}
            </div>
            <div *ngIf="['beforeChoose'].indexOf(currLevel) === -1">
              <table *ngFor="let item of conflictCourseMap | mapsToArray" class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th>衝堂課程名稱</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <span>{{item.course.CourseName || ''}}</span>
                    </td>
                  </tr>
                  <tr>
                    <td class="my-conflicts">
                      <span *ngFor="let conflictCourse of item.conflictCourses" class="my-conflict">
                        <span>{{conflictCourse.CourseName || ''}}</span>
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div *ngIf="conflictCourseMap.size === 0">目前無資料</div>
            </div>
          </div>
          <div [ngClass]="{'active': currTab === 'sa04', 'fade': currTab !== 'sa04'}" class="tab-pane sa04">
            <accordion>
              <accordion-group *ngFor="let item of faqA" panelClass="customAccordionClass">
                <a accordion-heading [innerHTML]="item.Title | safeHtml"></a>
                <div [innerHTML]="item.Content | safeHtml"></div>
              </accordion-group>
            </accordion>
            <div *ngIf="faqA.length === 0">目前無資料</div>
          </div>
          <div [ngClass]="{'active': currTab === 'sa05', 'fade': currTab !== 'sa05'}" class="tab-pane sa05">
            <accordion>
              <accordion-group *ngFor="let item of faqB" panelClass="customAccordionClass">
                <a accordion-heading [innerHTML]="item.Title | safeHtml"></a>
                <div [innerHTML]="item.Content | safeHtml"></div>
              </accordion-group>
            </accordion>
            <div *ngIf="faqB.length === 0">目前無資料</div>
          </div>
          <div [ngClass]="{'active': currTab === 'sa06', 'fade': currTab !== 'sa06'}" class="tab-pane sa06">
            <div>
              {{['尚未公告'][['afterChoose'].indexOf(currLevel)]}}
            </div>
            <div *ngIf="['afterChoose'].indexOf(currLevel) === -1">
              <table class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th>課程編號</th>
                    <th>課程名稱</th>
                    <th>授課教師</th>
                    <th>人數上限</th>
                    <th>教室</th>
                    <th>上課時間</th>
                  </tr>
                </thead>
                <tbody *ngFor="let item of currAttends">
                  <tr>
                    <td>{{item.NewSubjectCode}}</td>
                    <td>
                      <a *ngIf="item.Syllabus" [href]="item.Syllabus" target="_blank">{{item.CourseName}}</a>
                      <span *ngIf="!item.Syllabus">{{item.CourseName}}</span>
                    </td>
                    <td [innerHTML]="item.TeacherURLName | safeHtml"></td>
                    <td>{{item.MumberOfElectives}}</td>
                    <td>{{item.Classroom}}</td>
                    <td>{{item.CourseTimeInfo}}</td>
                  </tr>
                  <tr>
                    <td colspan="6">
                      <app-admission-list
                        [alumniId]="item.AlumniID"
                        (onClickMyName)="toggleTab('sa08')"
                      ></app-admission-list>
                    </td>
                  </tr>
                </tbody>
                <tbody *ngIf="currAttends.length === 0">
                  <tr>
                    <td colspan="6">目前無資料</td>
                </tbody>
              </table>
            </div>
          </div>
          <div [ngClass]="{'active': currTab === 'sa07', 'fade': currTab !== 'sa07'}" class="tab-pane sa07">
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>課程編號</th>
                  <th>課程名稱</th>
                  <th>授課教師</th>
                  <th>人數上限</th>
                  <th>教室</th>
                  <th>上課時間</th>
                </tr>
              </thead>
              <tbody *ngFor="let item of scAttends">
                <tr>
                  <td>{{item.NewSubjectCode}}</td>
                  <td>
                    <a *ngIf="item.Syllabus" [href]="item.Syllabus" target="_blank">{{item.CourseName}}</a>
                    <span *ngIf="!item.Syllabus">{{item.CourseName}}</span>
                  </td>
                  <td [innerHTML]="item.TeacherURLName | safeHtml"></td>
                  <td>{{item.MumberOfElectives}}</td>
                  <td>{{item.Classroom}}</td>
                  <td>{{item.CourseTimeInfo}}</td>
                </tr>
                <tr>
                  <td colspan="6">{{item.Memo}}</td>
                </tr>
              </tbody>
              <tbody *ngIf="scAttends.length === 0">
                <tr>
                  <td colspan="6">目前無資料</td>
              </tbody>
            </table>
          </div>
          <div [ngClass]="{'active': currTab === 'sa08', 'fade': currTab !== 'sa08'}" class="tab-pane sa08">
            <app-payment-list></app-payment-list>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <div class="footer-space"></div>
  <div class="footer">
    <img style="margin-right: 10px" src="assets/src/red_logo.jpg">
    <img style="margin-right: 10px" src="assets/src/bot_logo.png">
    <p style="text-align: left;">
      10617台北市大安區羅斯福路四段一號 臺灣大學管理學院一號館六樓 EMBA辦公室<br>
      TEL:886-2-33661010 FAX:886-2-23636073<br>
      Copyright © National Taiwan University All Rights Reserved
    </p>
  </div>
</div>